
spark.sql(" create table all_all_r_all_bkp.ods_contacts_addr_bkp_case1_11 like all_all_b_usa_crmods.ods_contacts_addr")

spark.sql("insert into all_all_r_all_bkp.ods_contacts_addr_bkp_case1_11 select * from all_all_b_usa_crmods.ods_contacts_addr")

spark.sql("""select * from all_all_r_all_bkp.hcp_addr_cleanup_case1 where address_mdm_id__c is not null and address_odw__c is not null and sf_id is null and addr_o_addr_odw_id is not null and addr_o_sf_id is not null and addr_od_mdm_addr_id_check = TRUE and addr_od_sf_id_check = FALSE and addr_od_account_check =TRUE and addr_sf_sf_id is null""").createOrReplaceTempView("df_rec_case11"); ----5623


spark.sql("""select * from df_rec_case11 base left anti join (select id from ph_com_p_usa_veeva.address_vod__c) dice on base.addr_o_sf_id=dice.id""").createOrReplaceTempView("df_rec"); ---27



spark.sql("""insert into ALL_ALL_B_USA_CRMODS.ods_contacts_addr_H select mdm_valid_addr_ind,best_times,cass_certified,mdm_addr_id,dly_scrub_date,mth_scrub_date,current_timestamp,rec_insert_date,addr_post_line_2,addr_post_line_1,fax_2,fax_1,rec_modify_date,rec_insert_date,batch_id_insert,rec_insert_by,inactive,staff_notes,office_notes,lic_valid_to_sample,sample_stat,dea_auth_stat_date,dea_auth_stat,dea_sched_cls,dea_lic_addr,dea_expirn_date,dea,zip_post,zip_4_post,zip_4,zip,cntry_code,state,phone_3,phone_2,phone_1,mobile_id,email4,email3,email2,email1,contact_fax_2,contact_fax_1,city_post,city,addr_line_2,addr_line_1,src,shipping,mig_stat,mailing,include_in_terr_asgnmt,appt_reqd,cc_flag,business,billing,account,home,contact_name,edge_id,par_edge_id,sonic_id,cam_key,acct_id,cont_id,primary,physician_key,sf_owner_id,sf_is_deleted,sf_id,addr_per_id,contacts_odw_id,contacts_addr_odw_id,cnty,siebel_id,scrub_req,batch_id_update,rec_modify_by,sample_eligibility_flag,State_Distributor_License_Exempt_vod__c,nvs_core_secondary_license__c, maps, sample_send_status_vod__c, nvs_core_novartis_unique_id__c from (SELECT odscont.mobile_id, odscont.email4, odscont.email3, odscont.email2, odscont.email1, odscont.contact_fax_2, odscont.contact_fax_1, odscont.city_post, odscont.city, odscont.addr_line_2, odscont.addr_line_1, odscont.src, odscont.shipping, odscont.mig_stat, odscont.mailing, odscont.include_in_terr_asgnmt, odscont.appt_reqd, odscont.cc_flag, odscont.business, odscont.billing, odscont.account, odscont.home, odscont.contact_name, odscont.edge_id, odscont.par_edge_id, odscont.sonic_id, odscont.cam_key, odscont.acct_id, odscont.cont_id, odscont.primary, odscont.physician_key, odscont.sf_owner_id, odscont.sf_is_deleted, odscont.sf_id, odscont.addr_per_id, odscont.contacts_odw_id, odscont.contacts_addr_odw_id, odscont.mdm_valid_addr_ind, odscont.best_times, odscont.cass_certified, odscont.mdm_addr_id, odscont.dly_scrub_date, odscont.mth_scrub_date, odscont.addr_post_line_2, odscont.addr_post_line_1, odscont.fax_2, odscont.fax_1, odscont.batch_id_insert, odscont.rec_insert_by, current_timestamp rec_modify_date, odscont.rec_insert_date, odscont.inactive, odscont.staff_notes, odscont.office_notes, odscont.lic_valid_to_sample, odscont.sample_stat, odscont.dea_auth_stat_date, odscont.dea_auth_stat, odscont.dea_sched_cls, odscont.dea_lic_addr, odscont.dea_expirn_date, odscont.dea, odscont.zip_post, odscont.zip_4_post, odscont.zip_4, odscont.zip, odscont.cntry_code, odscont.state, odscont.phone_3, odscont.phone_2, odscont.phone_1, odscont.scrub_req, odscont.cnty, odscont.siebel_id, odscont.batch_id_update batch_id_update, odscont.rec_modify_by rec_modify_by, odscont.sample_eligibility_flag,odscont.State_Distributor_License_Exempt_vod__c, odscont.nvs_core_secondary_license__c, odscont.maps, odscont.sample_send_status_vod__c, odscont.nvs_core_novartis_unique_id__c FROM ALL_ALL_B_USA_CRMODS.ods_contacts_addr odscont join df_rec base on trim(concat('CA',cast(odscont.contacts_addr_odw_id as string))) = trim(base.address_odw__c) and trim(base.address_mdm_id__c)=trim(odscont.mdm_addr_id) and trim(base.account_odw__c)= trim(concat('C',cast(odscont.contacts_odw_id as string))))""")


spark.sql(" create table if not exists all_all_r_all_bkp.ods_contacts_addr_t like all_all_b_usa_crmods.ods_contacts_addr")

spark.sql("truncate table all_all_r_all_bkp.ods_contacts_addr_t")


spark.sql("""Insert into all_all_r_all_bkp.ods_contacts_addr_t select ods.mobile_id, ods.email4, ods.email3, ods.email2, ods.email1, ods.contact_fax_2, ods.contact_fax_1, ods.city_post, ods.city, ods.addr_line_2, ods.addr_line_1, ods.src, ods.shipping, ods.mig_stat, ods.mailing, ods.include_in_terr_asgnmt, ods.appt_reqd, ods.cc_flag, ods.business, ods.billing, ods.account, ods.home, ods.contact_name, ods.edge_id, ods.par_edge_id, ods.sonic_id, ods.cam_key, ods.acct_id, ods.cont_id, ods.primary, ods.physician_key, ods.sf_owner_id, ods.sf_is_deleted, base.sf_id, ods.addr_per_id, ods.contacts_odw_id, ods.contacts_addr_odw_id, ods.mdm_valid_addr_ind, ods.best_times, ods.cass_certified, ods.mdm_addr_id, ods.dly_scrub_date, ods.mth_scrub_date, ods.addr_post_line_2, ods.addr_post_line_1, ods.fax_2, ods.fax_1, ods.batch_id_insert, ods.rec_insert_by, ods.rec_modify_date, ods.rec_insert_date, ods.inactive, ods.staff_notes, ods.office_notes, ods.lic_valid_to_sample, ods.sample_stat, ods.dea_auth_stat_date, ods.dea_auth_stat, ods.dea_sched_cls, ods.dea_lic_addr, ods.dea_expirn_date, ods.dea, ods.zip_post, ods.zip_4_post, ods.zip_4, ods.zip, ods.cntry_code, ods.state, ods.phone_3, ods.phone_2, ods.phone_1, ods.scrub_req, ods.cnty, ods.siebel_id, ods.batch_id_update, ods.rec_modify_by, ods.sample_eligibility_flag, ods.state_distributor_license_exempt_vod__c, ods.nvs_core_secondary_license__c, ods.maps, ods.sample_send_status_vod__c, ods.nvs_core_novartis_unique_id__c from all_all_b_usa_crmods.ods_contacts_addr ods join df_rec base on trim(concat('CA',cast(ods.contacts_addr_odw_id as string))) = trim(base.address_odw__c) and trim(base.address_mdm_id__c)=trim(ods.mdm_addr_id) and trim(base.account_odw__c)= trim(concat('C',cast(ods.contacts_odw_id as string)))""")

spark.sql("""insert into all_all_r_all_bkp.ods_contacts_addr_t select * from all_all_b_usa_crmods.ods_contacts_addr ods left anti join all_all_r_all_bkp.ods_contacts_addr_t tmp on ods.contacts_addr_odw_id = tmp.contacts_addr_odw_id and trim(ods.mdm_addr_id)= trim(tmp.mdm_addr_id) and ods.contacts_odw_id =tmp.contacts_odw_id""")

spark.sql("truncate table all_all_b_usa_crmods.ods_contacts_addr")

spark.sql("insert into all_all_b_usa_crmods.ods_contacts_addr select distinct * from all_all_r_all_bkp.ods_contacts_addr_t")

spark.sql(" drop table all_all_r_all_bkp.ods_contacts_addr_t ")
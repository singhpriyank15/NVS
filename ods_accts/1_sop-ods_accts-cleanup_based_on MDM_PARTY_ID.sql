--- BACKUP ---

spark.sql("create table ALL_ALL_R_ALL_BKP.ods_accts_bkp27AUG22_01 like ALL_ALL_B_USA_CRMODS.ods_accts")
spark.sql("insert into ALL_ALL_R_ALL_BKP.ods_accts_bkp27AUG22_01 select * from ALL_ALL_B_USA_CRMODS.ods_accts")

spark.sql("""create table if not exists all_all_r_all_bkp.ods_accts_t like ALL_ALL_B_USA_CRMODS.ods_accts""")

spark.sql("""truncate table all_all_r_all_bkp.ods_accts_t """)

spark.sql("""insert into table all_all_r_all_bkp.ods_accts_t select ods.future_coe__c,ods.site_agmt_revw_with,ods.patnt_intr,ods.site_agmt_revw_date,ods.lcz_attstn,ods.lcz_attst_prod,ods.xolair_attst_prod,ods.prod_attstn,ods.compliance_attstn,ods.stt_and_fed_law_attstn,ods.attst_prod,ods.msl_site_name,ods.group_s,ods.portfolio_msl_contact,ods.derm_rheum_clinic__c,ods.acct_odw_id,ods.mii_id,ods.acct_vendor_org_id,ods.acct_type,ods.acct_name,ods.acct_dba_name,ods.mii_nm,ods.alt_org_nm,ods.sf_id,ods.sf_is_deleted,ods.sf_owner_id,ods.mdm_addr_id,ods.mdm_cust_subtype,ods.mdm_cust_type,ods.mdm_odw_ins_date,ods.mdm_odw_upd_date,veeva.nvs_core_novartis_unique_id__c mdm_party_id,ods.mdm_src_id,ods.sonic_cdi_id,ods.sonic_con_addr_row_id,ods.sonic_id,ods.parent_sonic_mii_id,ods.parent_sonic_org_row_id,ods.sonic_org_ext_row_id,ods.sonic_par_ou_id,ods.sonic_org,ods.sonic_mnth_key,ods.src,ods.src_cust_type_code,ods.src_full_nm,ods.src_id,ods.src_mdm_cust_type_code,ods.src_org_nm,ods.acct_census_beds,ods.acct_cot_class,ods.acct_cot_fclty_type,ods.acct_fips_county,ods.acct_fips_state,ods.description,ods.cln_rsrch_capable,ods.heor_rsrch_capable,ods.pam_key_account,ods.cpf_elgbl,ods.request_code,ods.ff_department,ods.ms_kam_acct_tier,ods.payer_id,ods.scz_vldt_stat,ods.sec_scz_vldt_stat,ods.brd_cert_in,ods.key_oso_mm_contact_nov,ods.contacts_identifier,ods.tobi_validation_status,ods.hem_msl_contact,ods.onc_msl_contact,ods.rd_msl_contact,ods.academic_community,ods.pc_kam_key_account,ods.cln_rsrch_active,ods.mangd_market_segmnt,ods.heor_rsrch_active,ods.org_strata_level,ods.center_of_excell,ods.mangd_market_phy_grp,ods.created_by_id,ods.last_modified_id,ods.create_date,ods.last_modified_date,ods.siebel_id,ods.addr_row_id,ods.sonic_create_date,ods.sonic_org_type,ods.comments,ods.segment,ods.msa_no,ods.speclty_ind,ods.rec_insert_date,ods.rec_modify_date,ods.rec_insert_by,ods.rec_modify_by,ods.batch_id_insert,ods.batch_id_update,ods.medicare,ods.all_cust_key,ods.phone,ods.fax,ods.email,ods.dept_no,ods.totl_site,ods.edge_id,ods.owner_dept,ods.usmm_kam,ods.tot_rx_lives,ods.pbm_crv_out,ods.spclty_phrmcy,ods.case_mgr,ods.num_us_emp,ods.ebc,ods.chn_fclty_phrmcy_prvdr,ods.tot_fclts,ods.med_d_beds,ods.parta_beds,ods.phrmcy_type,ods.lvl,ods.comm_cntrct_date,ods.comm_cntrct_stat,ods.medcr_partd_cntrt_date,ods.medcr_partd_cntrt_stat,ods.medcd_partd_cntrt_date,ods.medcd_partd_cntrt_stat,ods.tot_covd_lives,ods.self_insurd,ods.ful_insurd,ods.trust,ods.top5_geo,ods.comm_drug_trnd_prcnt,ods.spclty_pmpm,ods.spclty_drug_cntr_prcnt,ods.tot_sls,ods.spclty_tot_prcnt_sls,ods.rx_sls,ods.tot_nvs_sls,ods.nvs_rtns,ods.nvs_rtns_prcnt,ods.top5_nvs_prod,ods.invtry_mnths_on_hnd,ods.invtry_as_of_date,ods.ex_dspns_rt_prcnt,ods.medcr_prcnt,ods.medcd_prcnt,ods.oth_thrd_prty_prcnt,ods.cthmnts,ods.departments,ods.rsdncy_prgms,ods.tot_rx_bdgt,ods.add_degs,ods.job_ttl,ods.plntrk_id,ods.hsg_id,ods.hlth_ldrs_id,ods.dea_no,ods.onc_cntrt_date,ods.onc_cntrt_stat,ods.pbm_tot_lives,ods.emplr,ods.hmo_ppo,ods.bcbs,ods.medcr_mm_pbm,ods.oth_fed,ods.other,ods.tot_of_phrm,ods.cntr_date,ods.cntrt_stat,ods.spclty_drug_trnd,ods.onc_kam,ods.tot_rev,ods.net_inc_loss,ods.medc_loss_ratio,ods.comm_prem_pmpm,ods.ftf_parent_mdm_id,ods.mdm_src,ods.mm_kam_acct_tier,ods.exec_sum,ods.fully_insured_rx_lives,ods.comm_insured_rx_lives,ods.comm_self_insured_rx_lives,ods.parent_id,ods.parent_odw_id,ods.acct_lic_beds,ods.acct_msa,ods.acct_or_surgeries,ods.acct_proc,ods.acct_profit_stat,ods.acct_staffed_beds,ods.acct_stat_ind,ods.acct_surgeries,ods.acct_web_site_url,ods.aha_no,ods.beds_no,ods.birthday,ods.birth_date,ods.birth_month,ods.bus,ods.bus_desc,ods.cam_key,ods.centre_no,ods.comm_pat_days_by_1000,ods.comm_premiums_pmpm,ods.contracts_prcs,ods.covd_lives,ods.custom_ext_id,ods.cust_excptn_flg,ods.cust_key,ods.ddd_no,ods.ddd_sub_cat_code,ods.dea_expy_date,ods.dea_schedd_code,ods.dea_valid_stat,ods.do_not_sync_sales_data,ods.elec_med_cnt,ods.employees,ods.excld_from_terr_asgnmt_rules,ods.excld_from_zip_to_terr_prcsg,ods.formatted_nm,ods.ft_pln_modl_type,ods.hin,ods.hmo,ods.hmo_mkt_shr,ods.hmo_pos,ods.holdy_obsvd,ods.ims_pln_id,ods.inactive_flg,ods.incl_in_terr_asgnmt,ods.may_edit,ods.mco_fax_no,ods.mco_phn_no,ods.mco_pln_city,ods.mco_pln_hq_stt,ods.mco_pln_modl_type,ods.mco_pln_oper_stt,ods.med_caid,ods.med_event,ods.med_expenses_pmpm,ods.med_loss_ratio,ods.mii_org_fac_spec,ods.mii_org_fac_type,ods.modl,ods.net_income_loss,ods.nov_cot,ods.nov_pln_seg,ods.nov_tc,ods.ofc_notes,ods.offerings,ods.ownership,ods.phm_24_hr_flg,ods.phm_disp_cls_code,ods.phm_disp_type_code,ods.phm_store_no,ods.pmpm_income_loss,ods.ppo,ods.ppo_pos,ods.programs,ods.regional_strategy,ods.res_cnt,ods.res_prog_flg,ods.staff_notes,ods.spend_cap,ods.stat_ind,ods.tax_stat,ods.teach_hosp_flg,ods.terr_vod,ods.tier,ods.tier_code,ods.totl_bed_cnt,ods.totl_lives,ods.totl_mds_dos,ods.totl_orgc_surg,ods.totl_phrmts,ods.totl_phys_enrold,ods.totl_revenue,ods.tumor_types,ods.veterans_affairs_hosp,ods.ytd_calls,ods.ytd_stt_spend,ods.oso_prmry_org,ods.med_care,ods.mco_type,ods.nov_id_stat,ods.prefd_meth_of_contact,ods.dmr_stat,ods.prev_meet_info,ods.nxt_meet_date,ods.acct_id2,ods.meet_pref,ods.key_oso_mm_contct,ods.oso_team,ods.key_msl_contct,ods.visn,ods.key_nasd_mmks,ods.oth_rel_info,ods.npi,ods.nvs_core_profit_status__c,ods.beds__c,ods.country_vod__c,ods.external_id_vod__c,ods.nvs_core_account_category__c,ods.nvs_core_account_subtype__c,ods.nvs_core_credentialing_required__c,ods.nvs_core_credentialing_service_company__c,ods.nvs_core_digital_id__c,ods.nvs_core_emr_system__c,ods.nvs_core_fiscal_id__c,ods.nvs_core_key_account__c,ods.nvs_core_legal_name__c,ods.nvs_core_national_code__c,ods.nvs_core_pricing_program__c,ods.nvs_core_salesforce_id__c,ods.nvs_core_sap_id__c,ods.nvs_core_status__c,ods.nvs_core_top_account_name__c,ods.nvs_core_vendor_id__c,ods.primary_parent_vod__c,ods.recordtype,ods.specialty_1_vod__c,ods.specialty_2_vod__c,ods.hco_phone from all_all_b_usa_crmods.ods_accts ods join (select nvs_core_novartis_unique_id__c,id from  ph_com_p_usa_veeva.account where ispersonaccount = false and isdeleted=false
and recordtypeid='0121O000001CG7KQAW' and trim(id) in ('0017000000p08GPAAY','0017000000p08GRAAY')) veeva  on ods.sf_id=veeva.id""")

spark.sql("""insert into ALL_ALL_B_USA_CRMODS.ods_accts_h select distinct acct.cpf_elgbl,acct.comm_insured_rx_lives,acct.fully_insured_rx_lives,acct.exec_sum,acct.mm_kam_acct_tier,acct.mdm_src,acct.ftf_parent_mdm_id,acct.comm_prem_pmpm,acct.medc_loss_ratio,acct.net_inc_loss,acct.tot_rev,acct.onc_kam,acct.spclty_drug_trnd,acct.cntrt_stat,acct.cntr_date,acct.tot_of_phrm,acct.other,acct.oth_fed,acct.medcr_mm_pbm,acct.bcbs,acct.hmo_ppo,acct.emplr,acct.pbm_tot_lives,acct.onc_cntrt_stat,acct.onc_cntrt_date,acct.dea_no,acct.hlth_ldrs_id,acct.hsg_id,acct.plntrk_id,acct.job_ttl,acct.add_degs,acct.tot_rx_bdgt,acct.rsdncy_prgms,acct.departments,acct.cthmnts,acct.oth_thrd_prty_prcnt,acct.medcd_prcnt,acct.medcr_prcnt,acct.ex_dspns_rt_prcnt,acct.invtry_as_of_date,acct.invtry_mnths_on_hnd,acct.top5_nvs_prod,acct.nvs_rtns_prcnt,acct.nvs_rtns,acct.tot_nvs_sls,acct.rx_sls,acct.spclty_tot_prcnt_sls,acct.tot_sls,acct.spclty_drug_cntr_prcnt,acct.spclty_pmpm,acct.comm_drug_trnd_prcnt,acct.top5_geo,acct.trust,acct.ful_insurd,acct.self_insurd,acct.tot_covd_lives,acct.medcd_partd_cntrt_stat,acct.medcd_partd_cntrt_date,acct.medcr_partd_cntrt_stat,acct.medcr_partd_cntrt_date,acct.comm_cntrct_stat,acct.comm_cntrct_date,acct.lvl,acct.phrmcy_type,acct.parta_beds,acct.med_d_beds,acct.tot_fclts,acct.chn_fclty_phrmcy_prvdr,acct.ebc,acct.num_us_emp,acct.case_mgr,acct.spclty_phrmcy,acct.pbm_crv_out,acct.tot_rx_lives,acct.usmm_kam,acct.owner_dept,acct.edge_id,acct.totl_site,acct.dept_no,acct.email,acct.fax,acct.phone,acct.all_cust_key,acct.medicare,acct.batch_id_insert,acct.rec_insert_date,acct.rec_modify_date,acct.rec_insert_by,nvl(acct.rec_modify_date,acct.rec_insert_date) eff_start_date,acct.speclty_ind,acct.msa_no,acct.segment,acct.oth_rel_info,acct.key_nasd_mmks,acct.visn,acct.key_msl_contct,acct.oso_team,acct.key_oso_mm_contct,acct.meet_pref,acct.acct_id2,acct.nxt_meet_date,acct.prev_meet_info,acct.dmr_stat,acct.prefd_meth_of_contact,acct.nov_id_stat,acct.mco_type,acct.med_care,acct.oso_prmry_org,acct.ytd_stt_spend,acct.ytd_calls,acct.veterans_affairs_hosp,acct.tumor_types,acct.compliance_attstn,acct.portfolio_msl_contact,acct.group_s,acct.msl_site_name,acct.prod_attstn,acct.xolair_attst_prod,acct.lcz_attst_prod,acct.lcz_attstn,acct.pam_key_account,acct.parent_odw_id,acct.parent_id,acct.comm_self_insured_rx_lives,acct.attst_prod,acct.ff_department,acct.derm_rheum_clinic__c,acct.future_coe__c,acct.request_code,acct.pc_kam_key_account,acct.academic_community,acct.rd_msl_contact,acct.onc_msl_contact,acct.hem_msl_contact,acct.tobi_validation_status,acct.contacts_identifier,acct.comments,acct.sonic_org_type,acct.sonic_create_date,acct.addr_row_id,acct.siebel_id,acct.last_modified_date,acct.create_date,acct.last_modified_id,acct.created_by_id,acct.mangd_market_phy_grp,acct.center_of_excell,acct.org_strata_level,acct.heor_rsrch_active,acct.mangd_market_segmnt,acct.cln_rsrch_active,acct.heor_rsrch_capable,acct.cln_rsrch_capable,acct.description,acct.payer_id,acct.ms_kam_acct_tier,acct.key_oso_mm_contact_nov,acct.brd_cert_in,acct.sec_scz_vldt_stat,acct.scz_vldt_stat,acct.site_agmt_revw_date,acct.patnt_intr,acct.site_agmt_revw_with,acct.stt_and_fed_law_attstn,acct.mdm_src_id,acct.mdm_party_id,acct.mdm_odw_upd_date,acct.mdm_odw_ins_date,acct.mdm_cust_type,acct.mdm_cust_subtype,acct.mdm_addr_id,acct.sf_owner_id,acct.sf_is_deleted,acct.sf_id,acct.alt_org_nm,acct.mii_nm,acct.acct_dba_name,acct.acct_name,acct.acct_type,acct.acct_vendor_org_id,acct.mii_id,acct.acct_odw_id,acct.totl_revenue,acct.totl_phys_enrold,acct.totl_phrmts,acct.totl_orgc_surg,acct.totl_mds_dos,acct.totl_lives,acct.totl_bed_cnt,acct.tier_code,acct.tier,acct.terr_vod,acct.teach_hosp_flg teach_hosp_flag,acct.tax_stat,acct.stat_ind,acct.spend_cap,acct.staff_notes,acct.res_prog_flg res_prog_flag,acct.res_cnt,acct.regional_strategy,acct.programs,acct.ppo_pos,acct.ppo,acct.pmpm_income_loss,acct.phm_store_no,acct.phm_disp_type_code,acct.phm_disp_cls_code,acct.phm_24_hr_flg phm_24_hr_flag,acct.ownership,acct.offerings,acct.ofc_notes,acct.nov_tc,acct.nov_pln_seg,acct.nov_cot,acct.net_income_loss,acct.modl,acct.mii_org_fac_type,acct.mii_org_fac_spec,acct.med_loss_ratio,acct.med_expenses_pmpm,acct.med_event,acct.med_caid,acct.mco_pln_oper_stt,acct.mco_pln_modl_type,acct.mco_pln_hq_stt,acct.mco_pln_city,acct.mco_phn_no,acct.mco_fax_no,acct.may_edit,acct.incl_in_terr_asgnmt,acct.inactive_flg inactive_flag,acct.ims_pln_id,acct.holdy_obsvd,acct.hmo_pos,acct.hmo_mkt_shr,acct.hmo,acct.hin,acct.ft_pln_modl_type,acct.formatted_nm,acct.excld_from_zip_to_terr_prcsg,acct.excld_from_terr_asgnmt_rules,acct.employees,acct.elec_med_cnt,current_timestamp eff_end_date,acct.do_not_sync_sales_data,acct.dea_valid_stat,acct.dea_schedd_code,acct.dea_expy_date,acct.ddd_sub_cat_code,acct.ddd_no,acct.cust_key,acct.cust_excptn_flg cust_excptn_flag,acct.custom_ext_id,acct.covd_lives,acct.contracts_prcs,acct.comm_premiums_pmpm,acct.comm_pat_days_by_1000,acct.centre_no,acct.cam_key,acct.bus_desc,acct.bus,acct.birth_month,acct.birth_date,acct.birthday,acct.beds_no,acct.aha_no,acct.acct_web_site_url,acct.acct_surgeries,acct.acct_stat_ind,acct.acct_staffed_beds,acct.acct_profit_stat,acct.acct_proc,acct.acct_or_surgeries,acct.acct_msa,acct.acct_lic_beds,acct.acct_fips_state,acct.acct_fips_county,acct.acct_cot_fclty_type,acct.acct_cot_class,acct.acct_census_beds,acct.src_org_nm,acct.src_mdm_cust_type_code,acct.src_id,acct.src_full_nm,acct.src_cust_type_code,acct.src,acct.sonic_mnth_key,acct.sonic_org,acct.sonic_par_ou_id,acct.sonic_org_ext_row_id,acct.parent_sonic_org_row_id,acct.parent_sonic_mii_id,acct.sonic_id,acct.sonic_con_addr_row_id,acct.sonic_cdi_id,acct.batch_id_update,acct.rec_modify_by,acct.npi,acct.nvs_core_profit_status__c,acct.Beds__c,acct.Country_vod__c,acct.External_ID_vod__c,acct.NVS_CORE_Account_Category__c,acct.NVS_CORE_Account_Subtype__c,acct.NVS_CORE_Credentialing_Required__c,acct.NVS_CORE_Credentialing_Service_Company__c,acct.NVS_CORE_Digital_ID__c,acct.NVS_CORE_EMR_System__c,acct.NVS_CORE_Fiscal_ID__c,acct.NVS_CORE_Key_Account__c,acct.NVS_CORE_Legal_Name__c,acct.NVS_CORE_National_Code__c,acct.NVS_CORE_Pricing_Program__c,acct.NVS_CORE_Salesforce_ID__c,acct.NVS_CORE_SAP_ID__c,acct.NVS_CORE_STATUS__c,acct.NVS_CORE_Top_Account_Name__c,acct.NVS_CORE_Vendor_ID__c,acct.Primary_Parent_vod__c,acct.RecordType,acct.Specialty_1_vod__c,acct.Specialty_2_vod__c,acct.hco_phone from ALL_ALL_B_USA_CRMODS.ods_accts acct join all_all_r_all_bkp.ods_accts_t d on trim(acct.sf_id)=trim(d.sf_id) """)


spark.sql("""insert into all_all_r_all_bkp.ods_accts_t select ods.* from all_all_b_usa_crmods.ods_accts ods left anti join all_all_r_all_bkp.ods_accts_t d on ods.sf_id=d.sf_id""")

spark.sql(""" truncate table ALL_ALL_B_USA_CRMODS.ods_accts """)

spark.sql(""" insert into ALL_ALL_B_USA_CRMODS.ods_accts select  distinct * from all_all_r_all_bkp.ods_accts_t """) 









